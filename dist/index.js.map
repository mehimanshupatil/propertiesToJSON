{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["// @ts-nocheck\nconst defaultValue = (v: any, d: any) => (v === undefined ? d : v);\n\nconst typesMap = {\n    false: false,\n    true: true,\n    undefined: undefined,\n    null: null,\n};\n\nconst defaults = {\n    jsonAsString: false,\n    convertToJsonTree: false,\n    parseNumber: false,\n    parseBooleanNullUndefined: false,\n};\n\nfunction isNumeric(value: string | number): boolean {\n    return value != null && value !== '' && !isNaN(Number(value.toString()));\n}\n\nconst propertiesToJSON = (str: string, options = defaults) => {\n    const parsedOptions = {\n        jsonAsString: defaultValue(options.jsonAsString, defaults.jsonAsString),\n        convertToJsonTree: defaultValue(options.convertToJsonTree, defaults.convertToJsonTree),\n        parseNumber: defaultValue(options.parseNumber, defaults.parseNumber),\n        parseBooleanNullUndefined: defaultValue(options.parseBooleanNullUndefined, defaults.parseBooleanNullUndefined),\n    };\n    const jsonObj = str\n        // Concat lines that end with '\\'.\n        .replace(/\\\\\\n( )*/g, '')\n        // Split by line breaks.\n        .split('\\n')\n        // Remove commented lines and empty lines\n        .filter((line) => (!line || /(\\#|\\!)/.test(line.replace(/\\s/g, '').slice(0, 1)) ? false : line))\n        // Create the JSON:\n        .reduce((obj, line) => {\n            // Replace only '=' that are not escaped with '\\' to handle separator inside key\n            const colonifiedLine = line.replace(/(?<!\\\\)=/, ':');\n            const key = colonifiedLine\n                // Extract key from index 0 to first not escaped colon index\n                .substring(0, colonifiedLine.search(/(?<!\\\\):/))\n                // Remove not needed backslash from key\n                .replace(/\\\\/g, '')\n                .trim();\n\n            let value = colonifiedLine.substring(colonifiedLine.search(/(?<!\\\\):/) + 1).trim() as string | number;\n\n            if (parsedOptions.parseNumber && isNumeric(value)) {\n                value = +value;\n            } else if (parsedOptions.parseBooleanNullUndefined) {\n                value = value in typesMap ? typesMap[value] : value;\n            }\n\n            if (!parsedOptions.convertToJsonTree) {\n                obj[key] = value;\n                return obj;\n            }\n\n            const keys = key.split('.');\n            return treeCreationRecursiveFn(keys, value, obj);\n        }, {});\n\n    if (parsedOptions.jsonAsString) return JSON.stringify(jsonObj);\n    return jsonObj;\n};\n\nconst regexG = /\\[(\\d)*?\\]/g;\nconst regex = /\\[(\\d)*?\\]/;\n\nconst treeCreationRecursiveFn = function (keys: string[], value: string | number, result: object) {\n    let key = keys[0];\n\n    const indexs = key.match(regexG)?.map((x) => +x.match(regex)[1]);\n    if (indexs) key = key.replace(regexG, '');\n\n    if (keys.length === 1) {\n        if (indexs) {\n            result[key] = arrayRecursiveFn(indexs, value, result[key] || []);\n        } else if (\n            result[key] &&\n            result[key].constructor === Object &&\n            (typeof value === 'string' || typeof value === 'number')\n        ) {\n            console.warn(`key missing for value ->`, value);\n            console.warn('The value will have empty string as a key');\n            result[key][''] = value;\n        } else {\n            result[key] = value;\n        }\n    } else {\n        let obj = {};\n\n        if (result[key] && result[key].constructor === Object) obj = result[key];\n        else if (typeof result[key] === 'string' || typeof result[key] === 'number') {\n            // conflicting case: a=b \\n a.c=d then o/p will be a: { '': 'b', c: 'd' }\n\n            obj = { '': result[key] };\n            console.warn(`key missing for value ->`, result[key]);\n            console.warn('The value will have empty string as a key');\n        }\n        if (indexs) {\n            const val = treeCreationRecursiveFn(keys.slice(1), value, obj);\n            result[key] = arrayRecursiveFn(indexs, val, result[key] || []);\n        } else result[key] = treeCreationRecursiveFn(keys.slice(1), value, obj);\n    }\n    return result;\n};\n\nconst arrayRecursiveFn = function (indexes, value, result) {\n    let index = indexes[0];\n    if (indexes.length === 1) {\n        if (result[index])\n            console.warn('conflicting case occured in array creation one or more properties can be replaced');\n        result[index] = value;\n    } else {\n        let obj = result[index] || [];\n        if (result[index] && typeof result[index] === 'string') {\n            console.warn('conflicting case occured in array creation one or more properties can be replaced');\n            obj = [];\n        } else if (result[index] && result[index].constructor === Object) {\n            /**\n             * o.a[1].b=we \n                o.a[1][2]=True \n             */\n            console.warn('conflicting case occured as array is object key will be \"\"');\n            obj = [];\n            result[index][''] = arrayRecursiveFn(indexes.slice(1), value, obj);\n        } else result[index] = arrayRecursiveFn(indexes.slice(1), value, obj);\n    }\n    return result;\n};\n\nexport default propertiesToJSON;\n"],"names":[],"mappings":"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"}